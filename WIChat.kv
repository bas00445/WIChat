#:import SwapTransition kivy.uix.screenmanager.SwapTransition
#:import FadeTransition kivy.uix.screenmanager.FadeTransition
#:import SlideTransition kivy.uix.screenmanager.SlideTransition

<WIChat>:

    startupScreen: StartupScreen
    mainUIScreen: MainUIScreen
    chatroomScreen: ChatroomScreen
    createGroupScreen: CreateGroupScreen

    StartupScreen:
        id: StartupScreen
    MainUIScreen:
        id: MainUIScreen
    ChatroomScreen:
        id: ChatroomScreen
    CreateGroupScreen:
        id: CreateGroupScreen


<StartupScreen>:
    name: "StartupScreen"

    nameInput: nameInput
    ipInput: ipInput
    portInput: portInput

    BoxLayout:
        orientation: 'vertical'
        spacing: 5
        Button:
            id: StartupLabel
            text: "Start Up"
            size_hint: 1, .2

        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: "NICKNAME\n(Max length = 8)"
                size_hint_x: .3
                halign: 'center'
            TextInput:
                id: nameInput
                text: "Untitiled"
                multiline: False
                size_hint_x: .7
                input_filter: lambda text, from_undo: text[:8 - len(self.text)]

        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: "HOST IP"
                size_hint_x: .3
            TextInput:
                id: ipInput
                text: "127.0.0.1"
                multiline: False
                size_hint_x: .7

        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: "PORT"
                size_hint_x: .3
            TextInput:
                id: portInput
                text: "5000"
                multiline: False
                size_hint_x: .7


        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1, .3
            Button:
                id: loginButton
                text: "LOG IN AS CLIENT"
                on_release: root.login()

            Button:
                id: loginButton
                text: "BECOME A HOST"
                on_release: root.openHostPopup()

<ProfileArea>:

    orientation: 'horizontal'
    profileButton: profileButton

    idButton: idButton
    nameButton: nameButton
    statusButton: statusButton
    size_hint: (1, .2)
    padding: 8

    canvas.before:
        Color:
            rgba: 0.027, 0.412, 0.698, 1
        Rectangle:
            pos: self.pos
            size: self.size

    Button:
        id: profileButton
        text: "Profile"
        size_hint_x: .3
        background_normal: 'backgroundPic.png'
        background_color: 0.196, 0.663, 0.914,  1
        border: 30,30,30,30

    BoxLayout:
        padding: 8
        spacing: 1
        orientation: 'vertical'

        Button:
            id: idButton
            text: "ID"
            pos_hint: {'x': .125}
            size_hint_x: .8
            size_hint_y: .2
            background_normal: ''
            background_color: 0.196, 0.663, 0.914,  1

        Button:
            id: nameButton
            text: "Name"
            pos_hint: {'x': .125}
            size_hint_x: .8
            size_hint_y: .2
            background_normal: ''
            background_color: 0.196, 0.663, 0.914,  1

        Button:
            id: statusButton
            text: "Status"
            pos_hint: {'x': .125}
            size_hint_x: .8
            size_hint_y: .2
            background_normal: ''
            background_color: 0.196, 0.663, 0.914,  1

<MenuBar>:
    orientation: 'horizontal'
    contactButton: contactButton
    historyButton: historyButton
    settingButton: settingButton
    size_hint: (1, .1)

    Button:
        text: 'Contact'
        id: contactButton
        background_normal: ''
        background_color: 0, 0.659, 0.925,  1

        on_release: app.root.mainUIScreen.changeScreen('contact')

    Button:
        text: 'History'
        id: historyButton
        background_normal: ''
        background_color: 0, 0.439, 0.620,  1

        on_release: app.root.mainUIScreen.changeScreen('history')

    Button:
        text: 'Setting'
        id: settingButton
        background_normal: ''
        background_color: 0.008, 0.267, 0.463,  1


<ContactComponent>:
    orientation: 'horizontal'
    size_hint: None, None
    width: app.root.mainUIScreen.width
    idButton: idButton
    nameButton: nameButton
    statusButton: statusButton

    Button:
        background_normal: ''
        background_color: 0.196, 0.663, 0.914,  1
        size_hint: .3, 1
        text: 'Pic'

        on_release: app.root.mainUIScreen.moveto_chatroom(idButton.text, nameButton.text)

    BoxLayout:
        orientation: 'vertical'

        Label:
            id: idButton
            canvas.before:
                Color:
                    rgba: 0.369, 0.545, 0.776, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Label:
            id: nameButton
            canvas.before:
                Color:
                    rgba: 0.369, 0.545, 0.776, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Label:
            id: statusButton
            text: "None"

            canvas.before:
                Color:
                    rgba: 0.369, 0.545, 0.776, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

<ContactScreen>:
    orientation: 'vertical'
    contactScrollView: contactScrollView
    groupScrollView: groupScrollView

    Accordion:
        orientation: 'vertical'

        AccordionItem:
            title: 'Available Groups'
            background_selected: 'accordionBG.png'
            background_normal: 'accordionBG.png'

            ScrollView:
                size: self.parent.width, self.parent.height
                size_hint: None,None
                GridLayout:
                    id: groupScrollView
                    cols: 1
                    spacing: 5
                    size_hint: 1,None
                    height: self.minimum_height

                    Button:
                        text: "+ Create a new group"
                        size_hint: 1, None
                        on_release: app.root.mainUIScreen.moveto_createGroup()


        AccordionItem:
            title: 'Available Contacts'

            ScrollView:
                size: self.parent.width, self.parent.height
                size_hint: None,None
                GridLayout:
                    id: contactScrollView
                    cols: 1
                    spacing: 5
                    size_hint: None,None
                    height: self.minimum_height


<HistoryScreen>:
    orientation: 'vertical'
    historyScrollView: historyScrollView

    ScrollView:
        size: self.parent.width, self.parent.height
        size_hint: None,None
        GridLayout:
            id: historyScrollView
            cols: 1
            spacing: 5
            size_hint: None,None
            height: self.minimum_height

<HistoryComponent>:
    orientation: 'horizontal'
    size_hint: None, None
    width: app.root.mainUIScreen.width

    idButton: idButton
    nameButton: nameButton
    lastestMessage: lastestMessage

    Button:
        background_normal: ''
        background_color: 0.196, 0.663, 0.914,  1
        size_hint: .3, 1
        text: 'Pic'
        on_release: app.root.mainUIScreen.moveto_chatroom(idButton.text, nameButton.text)

    BoxLayout:
        orientation: 'vertical'
        Label:
            id: idButton
            canvas.before:
                Color:
                    rgba: 0.369, 0.545, 0.776, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Label:
            id: nameButton
            canvas.before:
                Color:
                    rgba: 0.369, 0.545, 0.776, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Label:
            id: lastestMessage
            text: "None"
            canvas.before:
                Color:
                    rgba: 0.369, 0.545, 0.776, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

<ScreenSlider>:
    anim_move_duration: .3
    anim_cancel_duration: .5

    canvas.before:
        Color:
            rgba: 0.804, 0.804, 0.804, 1
        Rectangle:
            pos: self.pos
            size: self.size

    contactScreen: contactScreen
    historyScreen: historyScreen

    ContactScreen:
        id: contactScreen
    HistoryScreen:
        id: historyScreen

<InAppNotification>:
    orientation: 'horizontal'
    title: title
    detail: detail

    Label:
        id: title
        color: 0,0,0,1
        size_hint: .3,1

        canvas.before:
            Color:
                rgba: 0.745, 0.945, 0.549, 1
            Rectangle:
                pos: self.pos
                size: self.size

    Label:
        id: detail
        color: 0,0,0,1
        size_hint: .3,1

        canvas.before:
            Color:
                rgba: 0.894, 0.910, 0.922, 1
            Rectangle:
                pos: self.pos
                size: self.size


<MainUIScreen>:
    name: "MainUIScreen"
    profileArea: profileArea
    menuBar: menuBar
    screenSlider: screenSlider
    inAppNotification: inAppNotification

    FloatLayout:

        BoxLayout:
            orientation: 'vertical'
            ProfileArea:
                id: profileArea
            MenuBar:
                id: menuBar
            ScreenSlider:
                id: screenSlider

        BoxLayout:
            id: inAppNotification
            pos: -self.parent.width, self.parent.height - self.height
            size_hint: 1, .1
            orientation: 'horizontal'
            title: title
            detail: detail

            Label:
                id: title
                color: 0,0,0,1
                size_hint: .3,1

                canvas.before:
                    Color:
                        rgba: 0.745, 0.945, 0.549, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

            Label:
                id: detail
                color: 0,0,0,1
                size_hint: .7,1

                canvas.before:
                    Color:
                        rgba: 0.894, 0.910, 0.922, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size


<MessageBoxOwner>:
    textArea: textArea
    timeArea: timeArea
    senderArea: senderArea
    size_hint: 1, None
    orientation: 'horizontal'

    BoxLayout:
        orientation: 'vertical'
        size_hint: 1, None

        Label:
            id: textArea
            text: 'text message'
            size_hint_y: 0.8
            color: 0,0,0,1

            canvas.before:
                Color:
                    rgba: 0.894, 0.910, 0.922, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        Label:
            id: timeArea
            text: 'time'
            size_hint_y: 0.2
            color: 0,0,0,1

            canvas.before:
                Color:
                    rgba: 0.894, 0.910, 0.922, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

    Label:
        id: senderArea
        text: 'YOU'
        size_hint: 0.3, None

        canvas.before:
            Color:
                rgba: 0.192, 0.263, 0.592, 1
            Rectangle:
                pos: self.pos
                size: self.size

<MessageBoxPartner>:
    textArea: textArea
    timeArea: timeArea
    senderArea: senderArea
    size_hint: 1, None

    BoxLayout:

        orientation: 'horizontal'
        height: 400

        Label:
            id: senderArea
            text: 'Partner'
            color: 0, 0, 0, 1
            size_hint: 0.3, None

            canvas.before:
                Color:
                    rgba: 0.745, 0.945, 0.549, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

        BoxLayout:
            orientation: 'vertical'
            size_hint: 1, None

            Label:
                id: textArea
                text: 'text message'
                size_hint_y: 0.8
                color: 0,0,0,1

                canvas.before:
                    Color:
                        rgba: 0.894, 0.910, 0.922, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

            Label:
                id: timeArea
                text: 'time'
                size_hint_y: 0.2
                color: 0,0,0,1

                canvas.before:
                    Color:
                        rgba: 0.894, 0.910, 0.922, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

<FileChooserDialog>:
    orientation: 'vertical'
    chooser: filechooser

    FileChooserListView:
        id: filechooser
        path: "./"

    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: 0.1

        Button:
            text: 'Select'
            on_release: app.root.chatroomScreen.selectFile(root.chooser.path, root.chooser.selection)

<InviteComponent>:
    orientation: 'horizontal'
    size_hint: 1, None
    selection: selection

    idButton: idButton
    nameButton: nameButton

    CheckBox:
        id: selection
        size_hint: .1, None
        color: 0,0,0,1

        canvas.before:
            Color:
                rgba: 0.745, 0.945, 0.549, 1
            Rectangle:
                pos: self.pos
                size: self.size

    BoxLayout:
        orientation: 'vertical'
        Label:
            id: idButton
            text: "ID"
            color: 0,0,0,1
            size_hint: 1, .5

            canvas.before:
                Color:
                    rgba: 0.894, 0.910, 0.922, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
        Label:
            id: nameButton
            text: "Name"
            color: 0,0,0,1
            size_hint: 1, .5

            canvas.before:
                Color:
                    rgba: 0.894, 0.910, 0.922, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

<CreateGroupScreen>:
    name: "CreateGroupScreen"
    contactContainer: contactContainer
    groupNameInput: groupNameInput

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1, .1

            Label:
                text: 'Invite contacts to group'
                size_hint_x: .8

                canvas.before:
                    Color:
                        rgba: 0.369, 0.545, 0.776, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size

            Button:
                background_normal: ''
                background_color: 0.008, 0.267, 0.463, 1
                text: "Back"
                size_hint_x: .2
                on_release: app.root.chatroomScreen.moveto_mainUI()

        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1, .1

            Label:
                text: 'Group Name:'
                size_hint: .3, 1

            TextInput:
                id: groupNameInput
                size_hint: .7, 1
                multiline: False
                input_filter: lambda text, from_undo: text[:20 - len(self.text)]

        ScrollView:
            size: self.parent.width, self.parent.height
            do_scroll_x: False
            bar_width: 10
            bar_color: (0.000, 0.643, 0.616, 1)

            canvas.before:
                Color:
                    rgba: 0.804, 0.804, 0.804, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            GridLayout:
                id: contactContainer
                cols: 1
                padding: 10
                spacing: 10
                size_hint: 1,None
                height: self.minimum_height


        BoxLayout:
            orientation: 'horizontal'
            size_hint: 1, .1

            Button:
                text: 'Select'
                id: 'selectButton'
                size_hint: .5, 1
                on_release: root.sendInvitation()

            Button:
                text: 'Cancel'
                id: 'cancelButton'
                size_hint: .5, 1
                on_release: root.moveto_mainUI()



<ChatroomScreen>:
    name: "ChatroomScreen"
    chatContainer: chatContainer
    messageInput: messageInput
    roomName: roomName
    settingPanel: settingPanel

    FloatLayout:

        BoxLayout:
            BoxLayout:
                orientation: 'vertical'

                BoxLayout:
                    orientation: "horizontal"
                    size_hint: 1, .1

                    Button:
                        background_normal: ''
                        background_color: 0.369, 0.545, 0.776, 1

                        id: roomName
                        text: "Chatroom"
                        size_hint_x: .6

                    Button:
                        background_normal: ''
                        background_color: 0.008, 0.267, 0.463, 1
                        text: "Back"
                        size_hint_x: .2
                        on_release: app.root.chatroomScreen.moveto_mainUI()

                    Button:
                        background_normal: ''
                        background_color: 0.008, 0.267, 0.463, 1
                        text: "Setting"
                        size_hint_x: .2
                        on_release: root.showSettingPanel()

                ScrollView:
                    id: scrollView_chat
                    size: self.parent.width, self.parent.height
                    do_scroll_x: False
                    bar_width: 10
                    bar_color: (0.000, 0.643, 0.616, 1)

                    canvas.before:
                        Color:
                            rgba: 0.804, 0.804, 0.804, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                    GridLayout:
                        id: chatContainer
                        cols: 1
                        padding: 10
                        spacing: 10
                        size_hint: 1,None
                        height: self.minimum_height



                BoxLayout:
                    canvas.before:
                        Color:
                            rgba: 0.565, 0.663, 0.840, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                    padding: 6
                    orientation: 'horizontal'
                    size_hint: 1, .1


                    Button:
                        background_normal: ''
                        background_color: 0.071, 0.4, 0.840, 1

                        id: cfButton
                        text: 'SEND FILE'
                        size_hint: .25, 1
                        on_release: root.openChooserDialog()

                    TextInput:
                        id: messageInput
                        size_hint: .4, 1
                        multiline: False
                        input_filter: lambda text, from_undo: text[:30 - len(self.text)]
                        on_focus: root.hideSettingPanel()


                    Button:
                        background_normal: ''
                        background_color: 0.071, 0.4, 0.840, 1

                        id: sendButton
                        text: "SEND"
                        size_hint: .2, 1
                        on_release: app.root.clientSocket.setText(messageInput.text)
                        on_release: root.sendMessageTask()
                        on_release: root.messageInput.focus = True

        BoxLayout:
            id: settingPanel
            pos: -self.parent.width, 0
            size_hint_x: 0.6

            orientation: 'vertical'
            spacing: 5

            canvas.before:
                Color:
                    rgba: 0.565, 0.663, 0.840, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            Button:
                size_hint: 1, 0.2
                text: "Setting Panel"

            Button:
                text: "Backup"
                size_hint_y: 0.2

                background_normal: ''
                background_color: (0.000, 0.643, 0.616, 1)

                on_release: root.hideSettingPanel()

            Button:
                text: "Clear"
                size_hint_y: 0.2

                background_normal: ''
                background_color: (0.000, 0.643, 0.616, 1)

                on_release: root.hideSettingPanel()

            Button:
                text: "Block"
                size_hint_y: 0.2

                background_normal: ''
                background_color: (0.000, 0.643, 0.616, 1)

                on_release: root.hideSettingPanel()

            Button:
                text: "Block"
                size_hint_y: 0.2

                background_normal: ''
                background_color: (0.000, 0.643, 0.616, 1)

                on_release: root.hideSettingPanel()

            Button:
                text: "Block"
                size_hint_y: 0.2

                background_normal: ''
                background_color: (0.000, 0.643, 0.616, 1)

                on_release: root.hideSettingPanel()




